import "dotenv/config";
import express from "express";
import accessControlManager from "./service/access-control-manager.js";
import accessTokenManager from "./service/access-token-manager.js";

const app = express();
app.use(express.json());

const APP_PORT = 3000;
const USER_ID = "xxxx-xxxx-xxxx";

app.get("/token", (req, res) => {
  try {
    let token = accessTokenManager.generate(USER_ID, { user_id: USER_ID }, req.headers["user-agent"]);
    res.status(200).json({
      token,
      message: "success",
    });
  } catch (ex) {
    res.status(401).json({
      message: "server error",
    });
  }
});

app.get("/verify", accessControlManager.client, accessControlManager.auth, (req, res) => {
  res.status(200).json({
    message: "success",
    auth: req.auth,
  });
});

app.listen(APP_PORT, () => {
  console.log(`sever is running on http://localhost:${APP_PORT}`);
});
